### hw3.6

1. Необязательное задание: можно посмотреть целый фильм в консоли telnet towel.blinkenlights.nl :)  
Не получилось посмотреть:   
```
andrey@MSI:~$ telnet towel.blinkenlights.nl
Trying 213.136.8.188...
Trying 2001:7b8:666:ffff::1:42...
telnet: Unable to connect to remote host: Network is unreachable
```
---

2. Узнайте о том, сколько действительно независимых (не пересекающихся) каналов есть в разделяемой среде WiFi при работе на 2.4 ГГц.  
Стандарты с полосой 5 ГГц более актуальны, но регламенты на 5 ГГц существенно различаются в разных странах, а так же не раз обновлялись.  
В качестве дополнительного вопроса вне зачета, попробуйте найти актуальный ответ и на этот вопрос.  

При работе на 2.4ГГц есть три непересекающихся канала: 1(2412 МГц), 6(2437МГц), 11(2462МГц).  
При работе на 5ГГц по факту есть 25 непересекающихся каналов(36,40,44,48,52,56,60,64,149,153,157,161,165,100,104,108,112,116,120,124,128,132,136,140,144).  
В России актуально на данный момент 17 непересекающихся каналов(36,40,44,48,52,56,60,64,149,153,157,161,165,132,136,140,144).  

---

3. Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых называются OUI – Organizationally Unique Identifier или  
уникальный идентификатор организации. Какому производителю принадлежит MAC 38:f9:d3:55:55:79?  

Apple, Inc

---

4. Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер заголовков IPv4 – 20 байт, а TCP – 32 байта?  

payload(MSS)=MTU-TCP Header-IP Header=9001-20-32=8949байт  

---

5. Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при штатном режиме работы сети? Почему да или нет?  

Комбинация флага SYN и FIN, устанавливаемого в заголовке TCP, является недопустимой и относится к категории комбинации  
недопустимого / ненормального флага, поскольку она требует как установления соединения (через SYN), так и прекращения соединения (через FIN).  
Способ обработки таких недопустимых / аномальных комбинаций флагов не передается в RFC TCP. Таким образом, такие недопустимые / ненормальные  
комбинации флагов обрабатываются по-разному в разных операционных системах. Различные операционные системы также генерируют разные типы  
ответов для таких пакетов.  
Злоумышленники используют эти ответные пакеты, чтобы определить тип операционной системы в целевой системе. Таким образом, такие  
комбинации флагов всегда рассматриваются как вредоносные, и современные системы обнаружения вторжений обнаруживают такие комбинации, чтобы избежать атак.  

---

6. ss -ula sport = :53 на хосте имеет следующий вывод:  
State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process  
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*  
Почему в State присутствует только UNCONN, и может ли там присутствовать, например, TIME-WAIT?  

Опции ss в примере:  
-l вывести список сокетов, ожидающих соединений  
-u вывод данных по UDP-соединениям  
-a отобрать соединения, ожидающие подключений  
UNCONN - т.к. в UDP нет соединений.  
TIME-WAIT относится к TCP соединению(статус перед CLOSE - закрытием соединения), т.е. в данном случае TIME-WAIT не может присутствовать.  

---

7. Обладая знаниями о том, как штатным образом завершается соединение (FIN от инициатора, FIN-ACK от ответчика, ACK от инициатора),  
опишите в каких состояниях будет находиться TCP соединение в каждый момент времени на клиенте и на сервере при завершении.  
Схема переходов состояния соединения вам в этом поможет.  
Ответ:  
```
Client								            Server
FIN-WAIT1(send FIN)		
									                CLOSE-WAIT(send ACK)
FIN-WAIT2(recieve ACK, wait FIN)	
									                LAST-ACK(send FIN)
TIME-WAIT(recieve FIN, send ACK)
CLOSING()							            CLOSING()

```
---

8. TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста устанавливают между собой соединения. Каким будет теоретическое  
максимальное число соединений, ограниченное только лишь параметрами L4, которое параллельно может установить клиент с одного IP адреса к  
серверу с одним IP адресом? Сколько соединений сможет обслужить сервер от одного клиента? А если клиентов больше одного?  
Ответ:  
Со стороны клиента 65535 сокетов, со стороны сервера 65535 сокетов, теоретически сервер и клиент не может открыть более этого.  
Если клиентов более одного, то кол-во портов на сервере все такое же и ограничение тоже самое.  

---

9. Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии TIME-WAIT? Если да, то является ли она  
хорошей или плохой? Подкрепите свой ответ пояснением той или иной оценки.  
Ответ:  
Такая ситуация может быть, при общем большом количестве подключений, множестве кратковременных подключений, проблемах в  
сети(допустим не доходит FIN от сервера).  
Содинение в состоянии TIME-WAIT занимает системные ресурсы(память), поэтому эту ситуацию можно считать "плохой".  

---

10. Чем особенно плоха фрагментация UDP относительно фрагментации TCP?  
Фрагментированные UDP дейтаграммыне имеют номера последовательности(TCP сегменты имеют Acknowledgment Number (ACK SN), и если  
ip пакеты с этими дейтаграммами придут в неправильном порядке, информация будет искажена/потеряна.  

---

11. Если бы вы строили систему удаленного сбора логов, то есть систему, в которой несколько хостов отправяют на центральный узел  
генерируемые приложениями логи (предположим, что логи – текстовая информация), какой протокол транспортного уровня вы выбрали  
бы и почему? Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе syslog.  

В syslog для получения удаленных логов используется udp 514 порт. Мои предположения почему так сделано(и причины по которым я возможно сделал бы так же):  
Сессии тут не нужны (сообщение лога отправлено и все).  
Более низкая нагрузка на систему.  
Не нужны права root для отправки UDP дейтаграмм.  
Тот же syslog может работать по TCP, это решает проблему потерянных/испорченных/фрагментированных дейтаграм.  
Я бы выбрал TCP over TLS(syslog умеет, порт 6514) - контроль доставки + безопасно.  

---

12. Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной машине с Ubuntu, и каким процессам они принадлежат?  
```
vagrant@vagrant:~$ ss -t --listening
State             Recv-Q            Send-Q                       Local Address:Port                           Peer Address:Port            Process            
LISTEN            0                 128                                0.0.0.0:ssh                                 0.0.0.0:*                                  
LISTEN            0                 4096                               0.0.0.0:sunrpc                              0.0.0.0:*                                  
LISTEN            0                 4096                         127.0.0.53%lo:domain                              0.0.0.0:*                                  
LISTEN            0                 128                                   [::]:ssh                                    [::]:*                                  
LISTEN            0                 4096                                  [::]:sunrpc                                 [::]:*                                  
vagrant@vagrant:~$ 
```
В состоянии прослушивания ssh и rpc по ipv4 и ipv6.  

---

13. Какой ключ нужно добавить в tcpdump, чтобы он начал выводить не только заголовки, но и содержимое фреймов в текстовом виде? А в текстовом и шестнадцатиричном?
вывод содержимого фреймов в текстовом виде: -A
вывод содержимого фреймов в текстовом и шестнадцатиричном виде: -XX
```
	   -A     Print each packet (minus its link level header) in ASCII.  Handy for capturing web pages.

       -XX    When  parsing  and  printing,  in  addition  to printing the headers of each packet, print the data of each packet, including its link level header, in hex and ASCII.
```
---

14. Попробуйте собрать дамп трафика с помощью tcpdump на основном интерфейсе вашей виртуальной машины и посмотреть его через  
tshark или Wireshark (можно ограничить число пакетов -c 100). Встретились ли вам какие-то установленные флаги Internet Protocol  
(не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают. Как на самом деле называется стандарт Ethernet, фреймы которого попали  
в ваш дамп? Можно ли где-то в дампе увидеть OUI?  

Самый частый и в моем случае единственный флаг [DF] - dont fragment  
Также есть флаг [MF] - указывает на то, что это фрагмент пакета  
Насчет стандарта Ethernet не совсем уверен: IEEE 802.3 Ethernet (EN10MB):  
tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes  
На сайте tcpdump.org расшифровка:  
LINKTYPE_ETHERNET 	1 	DLT_EN10MB 	IEEE 802.3 Ethernet (10Mb, 100Mb, 1000Mb, and up); the 10MB in the DLT_ name is historical.  
OUI можно увидеть с опцией "-e"  
```
-e     Print the link-level header on each dump line.  This can be used, for example, to print MAC layer addresses for protocols such as Ethernet and IEEE 802.11.
```
